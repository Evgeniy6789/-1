<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>График смен — календарь</title>
  
  <!-- Дополнительные иконки для десктопных браузеров -->
	<link type="image/png" sizes="16x16" rel="icon" href="favicon-16x16.png">
	<link type="image/png" sizes="32x32" rel="icon" href="favicon-32x32.png">
	<link type="image/png" sizes="96x96" rel="icon" href="favicon-96x96.png">
	<link type="image/png" sizes="120x120" rel="icon" href="favicon-120x120.png">

	<!-- Иконки для Android -->
	<link type="image/png" sizes="72x72" rel="icon" href="android-icon-72x72.png">
	<link type="image/png" sizes="96x96" rel="icon" href="android-icon-96x96.png">
	<link type="image/png" sizes="144x144" rel="icon" href="android-icon-144x144.png">
	<link type="image/png" sizes="192x192" rel="icon" href="android-icon-192x192.png">
	<link type="image/png" sizes="512x512" rel="icon" href="android-icon-512x512.png">
	<link rel="manifest" href="manifest.json">

	<!-- Иконки для iOS (Apple) -->
	<link sizes="57x57" rel="apple-touch-icon" href="apple-touch-icon-57x57.png">
	<link sizes="60x60" rel="apple-touch-icon" href="apple-touch-icon-60x60.png">
	<link sizes="72x72" rel="apple-touch-icon" href="apple-touch-icon-72x72.png">
	<link sizes="76x76" rel="apple-touch-icon" href="apple-touch-icon-76x76.png">
	<link sizes="114x114" rel="apple-touch-icon" href="apple-touch-icon-114x114.png">
	<link sizes="120x120" rel="apple-touch-icon" href="apple-touch-icon-120x120.png">
	<link sizes="144x144" rel="apple-touch-icon" href="apple-touch-icon-144x144.png">
	<link sizes="152x152" rel="apple-touch-icon" href="apple-touch-icon-152x152.png">
	<link sizes="180x180" rel="apple-touch-icon" href="apple-touch-icon-180x180.png">

	<!-- Иконки для MacOS (Apple) -->
	<link color="#e52037" rel="mask-icon" href="safari-pinned-tab.svg">

	<!-- Иконки и цвета для плиток Windows -->
	<meta name="msapplication-TileColor" content="#2b5797">
	<meta name="msapplication-TileImage" content="mstile-144x144.png">
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png">
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png">
	<meta name="msapplication-wide310x150logo" content="mstile-310x310.png">
	<meta name="msapplication-square310x310logo" content="mstile-310x150.png">
	<meta name="application-name" content="My Application">
	<meta name="msapplication-config" content="browserconfig.xml">
</head>
  <style>
    /* Анимированный переливающийся яркий градиент */
    :root {
      --g1: #ff007a; --g2: #ffbf00; --g3: #00d4ff; --g4: #7cff00;
      --card: rgba(255,255,255,0.16); --card-border: rgba(255,255,255,0.35);
      --text-dark: #111; --text-light: #fff;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color: var(--text-light);
      background: linear-gradient(-45deg, var(--g1), var(--g2), var(--g3), var(--g4));
      background-size: 400% 400%;
      animation: gradientShift 10s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container { max-width: 1000px; margin: 0 auto; padding: 24px; }

    /* Живые часы */
    .live-clock {
      display: flex; justify-content: space-between; align-items: center; gap: 16px;
      padding: 16px 20px; border-radius: 16px; backdrop-filter: blur(8px);
      background: var(--card); border: 1px solid var(--card-border);
    }
    .live-clock h1 { margin: 0; font-size: 20px; font-weight: 800; }
    .clock-value { font-size: 18px; font-weight: 700; }

    /* Форма */
    .panel {
      margin-top: 16px; padding: 18px; border-radius: 16px; backdrop-filter: blur(8px);
      background: var(--card); border: 1px solid var(--card-border);
    }
    .panel h2 { margin: 0 0 12px; font-size: 18px; font-weight: 800; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(220px, 1fr)); gap: 12px 16px; }
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label { font-size: 14px; font-weight: 700; }
    .field input, .field select {
      border-radius: 10px; border: 1px solid var(--card-border); padding: 10px 12px;
      background: rgba(255,255,255,0.92); color: var(--text-dark); font-size: 14px; outline: none;
    }
    .actions { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      cursor: pointer; border: none; border-radius: 10px; padding: 10px 14px;
      font-weight: 800; color: var(--text-dark); background: #fff;
      transition: transform 0.08s ease, box-shadow 0.2s ease;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.2); }
    .btn.primary { background: #ffd400; }

    /* Итоги */
    .stats { margin-top: 12px; display: grid; grid-template-columns: repeat(2, minmax(220px, 1fr)); gap: 12px 16px; }
    .stat-card {
      padding: 12px; border-radius: 12px; backdrop-filter: blur(8px);
      background: var(--card); border: 1px solid var(--card-border);
    }
    .stat-card .label { font-size: 13px; opacity: 0.95; }
    .stat-card .value { font-size: 22px; font-weight: 900; }

    /* Календарь */
    .calendar {
      margin-top: 16px; padding: 16px; border-radius: 16px; backdrop-filter: blur(8px);
      background: var(--card); border: 1px solid var(--card-border);
    }
    .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .cal-title { font-size: 18px; font-weight: 900; }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
    .cal-weekday { text-align: center; font-weight: 800; font-size: 12px; opacity: 0.9; }

    .day {
      min-height: 64px; border-radius: 10px; padding: 8px;
      background: rgba(255,255,255,0.94); color: var(--text-dark);
      display: flex; flex-direction: column; justify-content: space-between; border: 2px solid transparent;
    }
    .day-number { font-weight: 900; }
    .badge {
      margin-top: 6px; font-size: 12px; font-weight: 800; border-radius: 8px; padding: 4px 6px; display: inline-block;
      color: #111; background: #7cff00;
    }
    .rest { background: rgba(255,255,255,0.9); }
    .shift { border-color: #00d4ff; }
    .night .badge { background: #00d4ff; color: #111; }

    .note { margin-top: 10px; font-size: 12px; opacity: 0.9; }

    @media (max-width: 700px) {
      .grid, .stats { grid-template-columns: 1fr; }
      .cal-grid { gap: 6px; }
      .day { min-height: 56px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Живые часы -->
    <div class="live-clock">
      <h1>График смен — календарь</h1>
      <div class="clock-value" id="liveClock">Загрузка…</div>
    </div>

    <!-- Форма ввода -->
    <div class="panel">
      <h2>Параметры</h2>
      <div class="grid">
        <div class="field">
          <label for="firstDay">Укажите дату вашего первого рабочего дня:</label>
          <input type="date" id="firstDay"/>
        </div>
        <div class="field">
          <label for="shiftType">Укажите ваш тип сменности:</label>
          <select id="shiftType">
            <option value="1/1">1/1 (1 работа, 1 отдых)</option>
            <option value="1/2">1/2 (1 работа, 2 отдых)</option>
            <option value="1/3">1/3 (1 работа, 3 отдых)</option>
            <option value="2/2">2/2 (2 работа, 2 отдых)</option>
            <option value="3/3">3/3 (3 работа, 3 отдых)</option>
            <option value="5/2">5/2 (пн–пт работа)</option>
            <option value="2/2_night">2/2 (ночные)</option>
          </select>
        </div>
        <div class="field">
          <label for="hoursPerShift">Сколько часов длится ваша смена:</label>
          <input type="number" id="hoursPerShift" min="1" max="24" value="12" placeholder="Например, 12"/>
        </div>
        <div class="field">
          <label for="monthsCount">На сколько месяцев рассчитать:</label>
          <select id="monthsCount">
            <option value="1">1 месяц</option>
            <option value="2" selected>2 месяца</option>
            <option value="3">3 месяца</option>
            <option value="4">4 месяца</option>
            <option value="5">5 месяца</option>
            <option value="6">6 месяца</option>
            <option value="7">7 месяца</option>
            <option value="8">8 месяца</option>
            <option value="9">9 месяца</option>
            <option value="10">10 месяца</option>
            <option value="11">11 месяца</option>
            <option value="12">12 месяца</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="calcBtn">Рассчитать</button>
        <button class="btn" id="todayBtn">Сбросить на текущий месяц</button>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="label">Смен в этом месяце:</div>
          <div class="value" id="shiftsInMonth">—</div>
        </div>
        <div class="stat-card">
          <div class="label">Всего часов:</div>
          <div class="value" id="totalHours">—</div>
        </div>
      </div>
    </div>

    <!-- Календарные месяцы -->
    <div id="calendars"></div>

    <div class="note">Подсветка: рабочие дни — с рамкой и зелёным бейджем; ночные — с синим бейджем.</div>
  </div>

  <script>
    // Живые часы
    const clockEl = document.getElementById('liveClock');
    const ruMonthsFull = ['января','февраля','марта','апреля','мая','июня','июля','августа','сентября','октября','ноября','декабря'];
    const pad = n => n.toString().padStart(2,'0');
    function updateClock(){
      const now = new Date();
      clockEl.textContent = `${pad(now.getDate())} ${ruMonthsFull[now.getMonth()]} ${now.getFullYear()}, ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
    }
    setInterval(updateClock, 250); updateClock();

    // Даты — утилиты
    const startOfMonth = date => new Date(date.getFullYear(), date.getMonth(), 1);
    const endOfMonth = date => new Date(date.getFullYear(), date.getMonth()+1, 0);
    const addDays = (date, days) => new Date(date.getFullYear(), date.getMonth(), date.getDate()+days);

    // Шаблоны сменности
    function getPattern(shiftType){
      if (shiftType === '1/1') return [true, false];
      if (shiftType === '1/2') return [true, false, false];
      if(shiftType === '1/3') return [true, false, false, false];
      if(shiftType === '2/2' || shiftType === '2/2_night') return [true, true, false, false];
      if(shiftType === '3/3') return [true, true, true, false, false, false];
      if(shiftType === '5/2') return [true, true, true, true, true, false, false]; // пн–пт работа
      return [true, false];
    }
    const isNight = type => type === '2/2_night';

    // Календарь для месяца
    function buildCalendarForMonth(baseFirstWorkDay, shiftType, hoursPerShift, year, monthIndex){
      const pattern = getPattern(shiftType);
      const nightFlag = isNight(shiftType);
      const monthStart = new Date(year, monthIndex, 1);
      const monthEnd = endOfMonth(monthStart);

      function isWorkDay(date){
        if(shiftType === '5/2'){
          const wd = date.getDay(); // 0-вс ... 6-сб
          return wd >= 1 && wd <= 5;
        } else {
          const diffDays = Math.floor((date - baseFirstWorkDay) / 86400000);
          const idx = ((diffDays % pattern.length) + pattern.length) % pattern.length;
          return pattern[idx];
        }
      }

      const days = []; let shiftsCount = 0;
      for(let d = new Date(monthStart); d <= monthEnd; d = addDays(d, 1)){
        const work = isWorkDay(d);
        if(work) shiftsCount++;
        days.push({date: new Date(d), work});
      }
      const totalHours = shiftsCount * hoursPerShift;

      const ruMonths = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
      const ruWeekdays = ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'];

      const wrap = document.createElement('div'); wrap.className = 'calendar';
      const header = document.createElement('div'); header.className = 'cal-header';
      header.innerHTML = `
        <div class="cal-title">${ruMonths[monthIndex]} ${year}</div>
        <div class="cal-stats">
          <span style="font-weight:800;">Смен:</span><span style="margin-left:6px;">${shiftsCount}</span>
          <span style="margin-left:14px;font-weight:800;">Часов:</span><span style="margin-left:6px;">${totalHours}</span>
        </div>`;
      wrap.appendChild(header);

      const grid = document.createElement('div'); grid.className = 'cal-grid';

      // Заголовок дней недели
      ruWeekdays.forEach(w => {
        const wd = document.createElement('div'); wd.className = 'cal-weekday'; wd.textContent = w; grid.appendChild(wd);
      });

      // Отступы до первого дня (неделя начинается с понедельника)
      const firstWeekday = (monthStart.getDay() + 6) % 7; // 0-вс -> 6, 1-пн -> 0
      for(let i=0; i<firstWeekday; i++) grid.appendChild(document.createElement('div'));

      // Дни месяца
      days.forEach(({date, work}) => {
        const cell = document.createElement('div'); cell.className = 'day ' + (work ? 'shift' : 'rest');
        const num = document.createElement('div'); num.className = 'day-number'; num.textContent = date.getDate();
        const badge = document.createElement('div'); badge.className = 'badge';
        if(work){
          badge.textContent = nightFlag ? 'Ночная смена' : 'Смена';
          if(nightFlag) cell.classList.add('night');
        } else {
          badge.textContent = 'Выходной'; badge.style.background = '#ffd400';
        }
        cell.appendChild(num); cell.appendChild(badge); grid.appendChild(cell);
      });

      wrap.appendChild(grid);
      return {element: wrap, shiftsCount, totalHours};
    }

    // Рендер
    const calendarsRoot = document.getElementById('calendars');
    const shiftsInMonthEl = document.getElementById('shiftsInMonth');
    const totalHoursEl = document.getElementById('totalHours');

    function renderMonths(firstWorkDay, shiftType, hoursPerShift, monthsCount){
      calendarsRoot.innerHTML = '';
      let monthShifts = 0, monthHours = 0;
      const start = new Date(); start.setHours(0,0,0,0);

      for(let i=0; i<monthsCount; i++){
        const dt = new Date(start.getFullYear(), start.getMonth()+i, 1);
        const {element, shiftsCount, totalHours} =
          buildCalendarForMonth(firstWorkDay, shiftType, hoursPerShift, dt.getFullYear(), dt.getMonth());
        calendarsRoot.appendChild(element);
        if(i === 0){ monthShifts = shiftsCount; monthHours = totalHours; }
      }
      shiftsInMonthEl.textContent = monthShifts;
      totalHoursEl.textContent = monthHours;
    }

    // Элементы формы
    const firstDayInput = document.getElementById('firstDay');
    const shiftTypeInput = document.getElementById('shiftType');
    const hoursInput = document.getElementById('hoursPerShift');
    const monthsInput = document.getElementById('monthsCount');
    const calcBtn = document.getElementById('calcBtn');
    const todayBtn = document.getElementById('todayBtn');

    function setTodayAsFirstDay(){
      const today = new Date();
      // ISO без смещения для корректного значения в input[type="date"]
      const iso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().split('T')[0];
      firstDayInput.value = iso;
    }

    function triggerCalc(){
      if(!firstDayInput.value){ alert('Укажите дату первого рабочего дня.'); return; }
      const firstWorkDay = new Date(firstDayInput.value + 'T00:00:00');
      const shiftType = shiftTypeInput.value;
      const hoursPerShift = Math.max(1, Math.min(24, parseInt(hoursInput.value || '12', 10)));
      const monthsCount = parseInt(monthsInput.value || '1', 10);
      renderMonths(firstWorkDay, shiftType, hoursPerShift, monthsCount);
    }

    calcBtn.addEventListener('click', triggerCalc);
    todayBtn.addEventListener('click', () => { setTodayAsFirstDay(); triggerCalc(); });

    // Значения по умолчанию
    (function init(){
      setTodayAsFirstDay();
      shiftTypeInput.value = '2/2';
      hoursInput.value = 12;
      monthsInput.value = 2;
      triggerCalc();
    })();
  </script>
</body>
</html>
